We have some ugly code here. Your task is to refactor code, and improve performance - in other words, Do the best you can!